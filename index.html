<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Schengen Days</title>
  <meta name="theme-color" content="#0E1430" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="./design-tokens.css" />
  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; }

    :root {
      --glass-border: rgba(255,255,255,.08);
      --soft-shadow: 0 12px 28px rgba(0,0,0,.35);
      --inner-shadow: inset 0 1px 0 rgba(255,255,255,.08);
      --risk-safe: #22C55E;
      --risk-mid: #F59E0B;
      --risk-high: #EF4444;
    }

    .app {
      margin: 0;
      min-height: 100%;
      color: var(--color-text-primary);
      font: 15px/1.35 -apple-system, BlinkMacSystemFont, "SF Pro Text", "Inter", "Segoe UI", Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 520px at 15% -5%, rgba(79,123,255,.22), transparent 62%),
        radial-gradient(900px 420px at 85% -20%, rgba(47,79,168,.28), transparent 66%),
        var(--color-bg-primary);
      -webkit-font-smoothing: antialiased;
      padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom);
    }

    .container {
      max-width: 420px;
      margin: 0 auto;
      padding: var(--space-12) var(--space-12) calc(var(--space-24) + env(safe-area-inset-bottom));
      display: grid;
      gap: var(--space-16);
    }

    .card {
      background: rgba(21,28,63,.92);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-card);
      box-shadow: var(--soft-shadow), var(--inner-shadow);
      padding: var(--space-16);
    }

    .hero { display: grid; justify-items: center; text-align: center; gap: var(--space-8); }
    .ring { position: relative; width: 180px; height: 180px; display: grid; place-items: center; }
    .ringSvg { width: 180px; height: 180px; transform: rotate(-90deg); }
    .ringTrack { fill: none; stroke: rgba(255,255,255,.12); stroke-width: 14px; }
    .ringProgress { fill: none; stroke: var(--risk-safe); stroke-width: 14px; stroke-linecap: round; transition: stroke .2s, stroke-dashoffset .35s ease; }
    .ringNumber { position: absolute; font-size: 56px; font-weight: 700; line-height: 1; }
    .heroLabel { margin: -4px 0 0; color: var(--color-text-secondary); font-size: 20px; font-weight: 600; }
    .heroSub { margin: 0; color: var(--color-text-primary); font-size: 16px; }

    .hero.risk-safe .ringProgress { stroke: var(--risk-safe); }
    .hero.risk-warning .ringProgress { stroke: var(--risk-mid); }
    .hero.risk-danger .ringProgress,
    .hero.risk-critical .ringProgress { stroke: var(--risk-high); }
    .hero.risk-critical .ring { animation: pulseRing 1.2s ease-in-out infinite; }
    @keyframes pulseRing { 0%,100% { transform: scale(1); } 50% { transform: scale(1.03); } }

    .primaryBtn {
      width: 100%;
      min-height: 52px;
      border: none;
      border-radius: var(--radius-button);
      background: linear-gradient(180deg, #5b88ff, var(--color-accent-primary));
      color: var(--color-text-primary);
      font-size: 18px;
      font-weight: 700;
      box-shadow: 0 8px 18px rgba(79,123,255,.35);
    }

    .timelineHead { margin: 0 0 var(--space-8); font-size: 18px; }
    .timelineRange { margin: 0 0 4px; color: var(--color-text-secondary); font-size: 13px; }
    .timelineUsage { margin: 0 0 var(--space-8); color: var(--color-text-primary); font-size: 14px; }
    .timelineGrid { display: grid; grid-template-columns: repeat(30, 1fr); gap: 4px; }
    .dayCell { height: 8px; border-radius: 999px; background: rgba(255,255,255,.12); }
    .dayCell.used { background: var(--color-accent-primary); }
    .dayCell.today { outline: 1px solid #fff; }

    .emptyState { text-align: center; padding: var(--space-16) 0; }
    .emptyTitle { margin: 0 0 var(--space-8); font-size: 18px; }
    .emptyText { margin: 0; color: var(--color-text-secondary); }

    .tripsTitle { margin: 0 0 var(--space-8); font-size: 18px; }
    .tripRow {
      display: flex; justify-content: space-between; gap: var(--space-8); align-items: flex-start;
      border: 1px solid var(--glass-border); border-radius: var(--radius-input);
      background: rgba(255,255,255,.03); padding: var(--space-12); margin-bottom: var(--space-8);
    }
    .tripMain { font-weight: 600; }
    .tripSub { margin-top: 3px; font-size: 13px; color: var(--color-text-secondary); }
    .rowBtns { display: flex; gap: var(--space-8); }
    .iconBtn { min-height: 44px; display: inline-flex; align-items: center; gap: 4px; }
    .icon { width: 13px; height: 13px; }

    .secondary {
      min-height: 44px;
      border: 1px solid var(--glass-border);
      background: rgba(255,255,255,.05);
      color: var(--color-text-primary);
      border-radius: var(--radius-pill);
      padding: 0 var(--space-12);
    }

    .iconOnlyBtn {
      min-width: 40px;
      min-height: 40px;
      width: 40px;
      height: 40px;
      border: 1px solid var(--glass-border);
      background: rgba(255,255,255,.05);
      border-radius: var(--radius-pill);
      color: var(--color-text-primary);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      line-height: 1;
      cursor: pointer;
    }

    .modalCloseBtn {
      position: absolute;
      top: var(--space-12);
      right: var(--space-12);
      min-width: 40px;
      min-height: 40px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid var(--glass-border);
      background: rgba(255,255,255,.05);
      color: var(--color-text-primary);
      font-size: 24px;
      line-height: 1;
      cursor: pointer;
    }

    .modalLayer {
      position: fixed;
      inset: 0;
      z-index: 30;
      display: grid;
      align-items: end;
      opacity: 0;
      pointer-events: none;
      transition: opacity .25s ease;
    }
    .modalLayer.open { opacity: 1; pointer-events: auto; }
    .modalBackdrop {
      position: absolute;
      inset: 0;
      background: rgba(5,8,22,.65);
      backdrop-filter: blur(4px);
    }
    .modalCard {
      position: relative;
      margin: 0 var(--space-8) var(--space-8);
      border-radius: 24px;
      background: rgba(21,28,63,.98);
      border: 1px solid var(--glass-border);
      box-shadow: var(--soft-shadow), var(--inner-shadow);
      padding: var(--space-16);
      transform: translateY(20px);
      transition: transform .25s ease;
    }
    .modalLayer.open .modalCard { transform: translateY(0); }
    .modalHead { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-12); }
    .modalTitle { margin: 0; font-size: 24px; }

    .field { display: grid; gap: var(--space-8); margin-bottom: var(--space-12); }
    .label { color: var(--color-text-secondary); font-size: 15px; font-weight: 600; }
    .inputWrap { position: relative; }
    .input {
      width: 100%;
      min-height: 48px;
      border-radius: var(--radius-input);
      border: 1px solid var(--glass-border);
      background: rgba(47,79,168,.22);
      color: var(--color-text-primary);
      padding: 0 44px 0 var(--space-12);
      font-size: 16px;
      outline: none;
    }
    .input:focus { border-color: var(--color-accent-primary); background: rgba(47,79,168,.28); }
    .calIcon { position: absolute; right: var(--space-12); top: 50%; transform: translateY(-50%); width: 18px; height: 18px; color: var(--color-text-secondary); pointer-events: none; }
    .input::-webkit-calendar-picker-indicator { opacity: 0; position: absolute; right: 0; width: 40px; height: 100%; }

    .quick-pills { display: flex; gap: var(--space-8); margin: var(--space-8) 0 var(--space-12); }
    .pill {
      min-height: 44px;
      min-width: 48px;
      border-radius: var(--radius-pill);
      border: 1px solid var(--glass-border);
      background: rgba(255,255,255,.06);
      color: var(--color-text-primary);
      font-weight: 600;
      font-size: 16px;
    }
    .pill.active { background: var(--color-accent-soft); border-color: var(--color-accent-primary); }

    .meta { color: var(--color-text-secondary); margin: 0 0 var(--space-8); }
    .hint { min-height: 18px; margin: 0 0 var(--space-8); font-size: 13px; color: var(--color-text-secondary); }
    .error { color: #ffb3b3; }
    .warn { color: #ffd28f; }

    .saveBtn {
      width: 100%;
      min-height: 52px;
      border: none;
      border-radius: var(--radius-button);
      background: linear-gradient(180deg, #5b88ff, var(--color-accent-primary));
      color: var(--color-text-primary);
      font-size: 20px;
      font-weight: 700;
      margin-top: var(--space-12);
    }
    .saveBtn:disabled { opacity: .5; }

    .subActions { margin-top: var(--space-8); display: flex; gap: var(--space-8); justify-content: flex-end; }

    .toast {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: calc(var(--space-24) + env(safe-area-inset-bottom)); z-index: 40;
      background: rgba(21,28,63,.96); border: 1px solid var(--glass-border);
      border-radius: var(--radius-pill); padding: var(--space-8) var(--space-12);
      display: flex; gap: var(--space-8); align-items: center;
      opacity: 0; pointer-events: none; transition: opacity .25s ease;
    }
    .toast.show { opacity: 1; pointer-events: auto; }

    .subtitle { text-align: center; color: var(--color-text-secondary); font-size: 12px; margin: 0; }
    .hide { display: none !important; }
  </style>
</head>
<body class="app">
  <main class="container">
    <section id="hero" class="card hero" aria-live="polite">
      <div class="ring">
        <svg class="ringSvg" viewBox="0 0 180 180" aria-hidden="true">
          <circle class="ringTrack" cx="90" cy="90" r="62"></circle>
          <circle id="heroRingProgress" class="ringProgress" cx="90" cy="90" r="62"></circle>
        </svg>
        <div id="ringNumber" class="ringNumber">90</div>
      </div>
      <p id="heroLabel" class="heroLabel">You have 90 days left</p>
      <p id="heroSentence" class="heroSub">If you enter today, you must leave by —.</p>
    </section>

    <section class="card">
      <h3 class="timelineHead">Your last 180 days</h3>
      <div id="timelineEmpty" class="emptyState hide">
        <p class="emptyTitle">No trips yet.</p>
        <p class="emptyText">Add your first trip to start tracking.</p>
      </div>
      <p id="timelineRange" class="timelineRange"></p>
      <p id="timelineUsage" class="timelineUsage"></p>
      <div id="timelineGrid" class="timelineGrid"></div>
    </section>

    <button id="openAddTripBtn" type="button" class="primaryBtn">+ Add trip</button>

    <section id="tripsCard" class="card">
      <h3 class="tripsTitle">Your trips</h3>
      <div id="tripsEmpty" class="tripSub">You haven’t added any trips yet.</div>
      <div id="tripsList"></div>
    </section>

    <p class="subtitle">Estimates only. Verify official Schengen rules.</p>
  </main>

  <div id="tripModal" class="modalLayer" aria-hidden="true">
    <div id="modalBackdrop" class="modalBackdrop"></div>
    <section class="modalCard" role="dialog" aria-modal="true" aria-labelledby="tripModalTitle">
      <div class="modalHead">
        <h2 id="tripModalTitle" class="modalTitle">Add a trip</h2>
      </div>
      <button id="closeTripModalBtn" type="button" class="modalCloseBtn" aria-label="Close add trip modal" title="Close">×</button>

      <div class="field">
        <label class="label" for="entryDate">Entry date</label>
        <div class="inputWrap">
          <input class="input" type="date" id="entryDate" />
          <svg class="calIcon" viewBox="0 0 24 24" fill="none"><path d="M7 2v3M17 2v3M3 9h18M5 5h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </div>
      </div>

      <div class="field">
        <label class="label" for="exitDate">Exit date</label>
        <div class="inputWrap">
          <input class="input" type="date" id="exitDate" />
          <svg class="calIcon" viewBox="0 0 24 24" fill="none"><path d="M7 2v3M17 2v3M3 9h18M5 5h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </div>
      </div>

      <div class="quick-pills">
        <button class="pill quickBtn" type="button" data-quick="1">1d</button>
        <button class="pill quickBtn" type="button" data-quick="7">7d</button>
        <button class="pill quickBtn" type="button" data-quick="14">14d</button>
        <button class="pill quickBtn" type="button" data-quick="30">30d</button>
      </div>

      <p class="meta">Trip length: <strong id="tripLength">—</strong></p>
      <p id="tripError" class="hint error"></p>
      <p id="tripWarning" class="hint warn"></p>

      <button id="saveTripBtn" type="button" class="saveBtn">Save trip</button>
      <div class="subActions">
        <button id="swapDatesBtn" type="button" class="secondary hide">Swap dates</button>
        <button id="cancelEditBtn" type="button" class="secondary hide">Cancel</button>
      </div>
    </section>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite">
    <span id="toastText"></span>
    <button id="undoBtn" class="secondary hide" type="button">Undo</button>
  </div>

  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(() => {});
    }
  </script>
</body>
</html>
